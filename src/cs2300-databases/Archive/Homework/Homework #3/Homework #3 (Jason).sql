/*
Difference:
- Employee's Super_Ssn doesn't reference self's SSN
- Values are added multiple times.
- Joined was used more heavily than manually setting referencing attributes (I prefer the join syntax, but she heavily recommended implicitly joining)

*/

CREATE TABLE EMPLOYEE
(Fname VARCHAR(15) NOT NULL,
Minit CHAR,
Lname VARCHAR(15) NOT NULL,
Ssn CHAR(9) NOT NULL,
Bdate DATE,
Address VARCHAR(30),
Sex CHAR,
Salary DECIMAL(10,2),
Super_ssn CHAR(9),
Dno INT NOT NULL,
PRIMARY KEY(Ssn));

CREATE TABLE DEPARTMENT
(Dname VARCHAR(15) NOT NULL,
Dnumber INT NOT NULL,
Mgr_ssn CHAR(9) NOT NULL,
Mgr_start_date DATE,
PRIMARY KEY(Dnumber),
UNIQUE(Dname),
FOREIGN KEY(Mgr_ssn) REFERENCES EMPLOYEE(Ssn));

CREATE TABLE DEPT_LOCATIONS
(Dnumber INT NOT NULL,
Dlocation VARCHAR(15) NOT NULL,
PRIMARY KEY(Dnumber, Dlocation),
FOREIGN KEY(Dnumber) REFERENCES DEPARTMENT(Dnumber));

CREATE TABLE PROJECT
(Pname VARCHAR(15) NOT NULL,
Pnumber INT NOT NULL,
Plocation VARCHAR(15),
Dnum INT NOT NULL,
PRIMARY KEY(Pnumber),
UNIQUE(Pname),
FOREIGN KEY(Dnum) REFERENCES DEPARTMENT(Dnumber));

CREATE TABLE WORKS_ON
(Essn CHAR(9) NOT NULL,
Pno INT NOT NULL,
Hours DECIMAL(3,1),
PRIMARY KEY(Essn, Pno),
FOREIGN KEY(Essn) REFERENCES EMPLOYEE(Ssn),
FOREIGN KEY(Pno) REFERENCES PROJECT(Pnumber));

CREATE TABLE DEPENDENT
(Essn CHAR(9) NOT NULL,
Dependent_name VARCHAR(15) NOT NULL,
Sex CHAR,
Bdate DATE,
Relationship VARCHAR(8),
PRIMARY KEY(Essn, Dependent_name),
FOREIGN KEY(Essn) REFERENCES EMPLOYEE(Ssn));

INSERT INTO EMPLOYEE
VALUES ('John', 'B', 'Smith', 123456789, to_date('19650109','YYYYMMDD'), '731 Fondren, Houston, TX', 'M', 30000, 333445555, 5);

INSERT INTO EMPLOYEE
VALUES ('Franklin', 'T', 'Wong', 333445555, to_date('19551208','YYYYMMDD'), '638 Voss, Houston, TX', 'M', 40000, 888665555, 5);

INSERT INTO EMPLOYEE
VALUES ('Alicia', 'J', 'Zelaya', 999887777, to_date('19680119','YYYYMMDD'), '3321 Castle, Spring, TX', 'F', 25000, 987654321, 4);

INSERT INTO EMPLOYEE
VALUES ('Jennifer', 'S', 'Wallace', 987654321, to_date('19410620','YYYYMMDD'), '291 Berry, Bellaire, TX', 'F', 43000, 888665555, 4);

INSERT INTO EMPLOYEE
VALUES ('Ramesh', 'K', 'Narayan', 666884444, to_date('19620915','YYYYMMDD'), '975 Fire Oak, Humble, TX', 'M', 38000, 333445555, 5);

INSERT INTO EMPLOYEE
VALUES ('Joyce', 'A', 'English', 453453453, to_date('19720731','YYYYMMDD'), '5631 Rice, Houston, TX', 'F', 25000, 333445555, 5);

INSERT INTO EMPLOYEE
VALUES ('Ahmad', 'V', 'Jabbar', 987987987, to_date('19690329','YYYYMMDD'), '980 Dallas, Houston, TX', 'M', 25000, 987654321, 4);

INSERT INTO EMPLOYEE
VALUES ('James', 'E', 'Borg', 888665555, to_date('19371110','YYYYMMDD'), '450 Stone, Houston, TX', 'M', 55000, NULL, 1);

INSERT INTO DEPARTMENT
VALUES ('Research',5,333445555,to_date('19880522','YYYYMMDD'));

INSERT INTO DEPARTMENT
VALUES ('Administration',4,987654321,to_date('19950101','YYYYMMDD'));

INSERT INTO DEPARTMENT
VALUES ('Headquarters',1,888665555,to_date('19810619','YYYYMMDD'));

INSERT INTO DEPT_LOCATIONS
VALUES (1,'Houston');

INSERT INTO DEPT_LOCATIONS
VALUES (4,'Stafford');

INSERT INTO DEPT_LOCATIONS
VALUES (5,'Bellaire');

INSERT INTO DEPT_LOCATIONS
VALUES (5,'Sugarland');

INSERT INTO DEPT_LOCATIONS
VALUES (5,'Houston');

INSERT INTO PROJECT
VALUES ('ProductX',1,'Bellaire',5);

INSERT INTO PROJECT
VALUES ('ProductY',2,'Sugarland',5);

INSERT INTO PROJECT
VALUES ('ProductZ',3,'Houston',5);

INSERT INTO PROJECT
VALUES ('Computerization',10,'Stafford',4);

INSERT INTO PROJECT
VALUES ('Reorganization',20,'Houston',1);

INSERT INTO PROJECT
VALUES ('Newbenefits',30,'Stafford',4);

INSERT INTO DEPENDENT
VALUES (333445555,'Alice','F',to_date('19860405','YYYYMMDD'),'Daughter');

INSERT INTO DEPENDENT
VALUES (333445555,'Theodore','M',to_date('19831025','YYYYMMDD'),'Son');

INSERT INTO DEPENDENT
VALUES (333445555,'Joy','F',to_date('19580503','YYYYMMDD'),'Spouse');

INSERT INTO DEPENDENT
VALUES (987654321,'Abner','M',to_date('19420228','YYYYMMDD'),'Spouse');

INSERT INTO DEPENDENT
VALUES (123456789,'Michael','M',to_date('19880104','YYYYMMDD'),'Son');

INSERT INTO DEPENDENT
VALUES (123456789,'Alice','F',to_date('19881230','YYYYMMDD'),'Daughter');

INSERT INTO DEPENDENT
VALUES (123456789,'Elizabeth','F',to_date('19670505','YYYYMMDD'),'Spouse');

INSERT INTO WORKS_ON
VALUES (123456789,1,32.5);

INSERT INTO WORKS_ON
VALUES (123456789,2,7.5);

INSERT INTO WORKS_ON
VALUES (666884444,3,40.0);

INSERT INTO WORKS_ON
VALUES (453453453,1,20.0);

INSERT INTO WORKS_ON
VALUES (453453453,2,20.0);

INSERT INTO WORKS_ON
VALUES (333445555,2,10.0);

INSERT INTO WORKS_ON
VALUES (333445555,3,10.0);

INSERT INTO WORKS_ON
VALUES (333445555,10,10.0);

INSERT INTO WORKS_ON
VALUES (333445555,20,10.0);

INSERT INTO WORKS_ON
VALUES (999887777,30,30.0);

INSERT INTO WORKS_ON
VALUES (999887777,10,10.0);

INSERT INTO WORKS_ON
VALUES (987987987,10,35.0);

INSERT INTO WORKS_ON
VALUES (987987987,30,5.0);

INSERT INTO WORKS_ON
VALUES (987654321,30,20.0);

INSERT INTO WORKS_ON
VALUES (987654321,20,15.0);

INSERT INTO WORKS_ON
VALUES (888665555,20,NULL);

SELECT ALL *
FROM EMPLOYEE;

SELECT ALL *
FROM DEPARTMENT;

SELECT ALL *
FROM DEPT_LOCATIONS;

SELECT ALL *
FROM PROJECT;

SELECT ALL *
FROM WORKS_ON;

SELECT ALL *
FROM DEPENDENT;

SELECT Fname,Minit,Lname
FROM (EMPLOYEE JOIN (WORKS_ON JOIN PROJECT ON Pno=Pnumber) ON Ssn=Essn)
WHERE Dno=5 AND Hours > 10 AND Pname = 'ProductX';

SELECT Fname, Minit, Lname
FROM (EMPLOYEE JOIN DEPENDENT ON Ssn=Essn)
WHERE Fname=Dependent_name;

SELECT Fname,Minit,Lname
FROM EMPLOYEE B
WHERE B.Super_Ssn = (SELECT C.Ssn
FROM EMPLOYEE C
WHERE Fname='Franklin' AND Lname='Wong');

SELECT Pname, SUM(Hours)
FROM PROJECT, WORKS_ON
WHERE Pnumber=Pno
GROUP BY Pname;

SELECT Fname,Minit,Lname
FROM EMPLOYEE
WHERE NOT EXISTS ((SELECT Pnumber
FROM PROJECT)
Minus (Select Pno
FROM WORKS_ON
WHERE Ssn=Essn));

SELECT Fname,Minit,Lname
FROM EMPLOYEE
WHERE NOT EXISTS(SELECT Pno
FROM WORKS_ON
WHERE Ssn=Essn);

SELECT Dname, AVG(Salary)
FROM EMPLOYEE, DEPARTMENT
WHERE Dno=Dnumber
GROUP BY Dname;

SELECT AVG(Salary)
FROM EMPLOYEE
WHERE Sex='F';

SELECT Fname,Minit,Lname,Address
FROM EMPLOYEE, WORKS_ON
WHERE Ssn=Essn AND Pno IN(SELECT Pnumber
FROM PROJECT
WHERE Plocation='Houston')
MINUS
(SELECT Fname,Minit,Lname,Address
FROM EMPLOYEE D, DEPT_LOCATIONS
WHERE Dno=Dnumber AND Dlocation='Houston');

SELECT Lname
FROM EMPLOYEE
WHERE Ssn IN(SELECT Super_ssn
FROM EMPLOYEE) AND Ssn NOT IN(SELECT Essn
FROM DEPENDENT);

DROP TABLE DEPENDENT;
DROP TABLE WORKS_ON;
DROP TABLE PROJECT;
DROP TABLE DEPT_LOCATIONS;
DROP TABLE DEPARTMENT;
DROP TABLE EMPLOYEE;